DATABASE_URL=
JWT_SECRET=
PORT=3000

## DeepSeek (OpenAI-compatible) API
DEEPSEEK_API_KEY=
DEEPSEEK_BASE_URL=https://api.deepseek.com

## Grok / xAI (OpenAI-compatible) API
XAI_API_KEY=
XAI_BASE_URL=https://api.x.ai/v1

## Gemini (Google) API
GEMINI_API_KEY=
GEMINI_BASE_URL=https://generativelanguage.googleapis.com

## OpenRouter (OpenAI-compatible) API
OPENROUTER_API_KEY=
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_SITE_URL=https://spicenest.cc
OPENROUTER_APP_NAME=spicenest

# Chat: 基础参数（必填）
CHAT_RECENT_WINDOW_MAX_MESSAGES=80
CHAT_RECENT_WINDOW_MAX_CHARS=36000

# Chat: day time zone（必填）
CHAT_DAY_TIME_ZONE=Asia/Shanghai

# Chat: time context (system segment)
CHAT_TIME_CONTEXT_ENABLED=true
CHAT_TIME_CONTEXT_TIME_ZONE=Asia/Shanghai
# tokens: {{now}} {{last}} {{gap_human}} {{gap_minutes}} {{gap_ms}} {{time_zone}}
CHAT_TIME_CONTEXT_TEMPLATE=[现实时间]\n- 这是感知现实维度的上下文数据，不是对话指令。\n- 除非用户明确询问现实时间/日期/相隔时长，否则不要在回复中提及或复述其中字段。\n当前时间={{now}} ({{time_zone}})\n上次对话时间={{last}}\n距离上次对话间隔={{gap_human}} ({{gap_minutes}}m)
# Only injected when the user explicitly asks about time/date/gap.
CHAT_TIME_CONTEXT_USER_TEMPLATE=[现实时间]\n 当前时间={{now}} ({{time_zone}})\n上次对话时间={{last}}\n距离上次对话间隔={{gap_human}}

# recent_window anti-self-echo
CHAT_RECENT_WINDOW_ASSISTANT_GIST_ENABLED=true
CHAT_RECENT_WINDOW_ASSISTANT_RAW_LAST_N=2
CHAT_RECENT_WINDOW_ASSISTANT_GIST_PREFIX=【assistant 早期输出概括】

# Chat Memory
## 模型参数
CHAT_MEMORY_WORKER_PROVIDER=deepseek
CHAT_MEMORY_WORKER_MODEL=deepseek-chat
CHAT_MEMORY_WORKER_TEMPERATURE=0.2
CHAT_MEMORY_WORKER_TOP_P=0.9
CHAT_MEMORY_WORKER_MAX_OUTPUT_TOKENS=6000
CHAT_MEMORY_WORKER_STREAM=false
CHAT_MEMORY_WORKER_ENABLE_WEB_SEARCH=false
CHAT_MEMORY_WORKER_SAFETY_HARASSMENT=OFF
CHAT_MEMORY_WORKER_SAFETY_HATE_SPEECH=OFF
CHAT_MEMORY_WORKER_SAFETY_SEXUALLY_EXPLICIT=OFF
CHAT_MEMORY_WORKER_SAFETY_DANGEROUS_CONTENT=OFF
CHAT_MEMORY_WORKER_THINKING_LEVEL=MINIMAL
CHAT_MEMORY_WORKER_THINKING_BUDGET=0
CHAT_MEMORY_WORKER_OPENAI_COMPATIBLE_BODY_JSON={}
CHAT_MEMORY_WORKER_GOOGLE_GENAI_CONFIG_JSON={}
## 其余配置
CHAT_ROLLING_SUMMARY_MAX_CHARS=6000
CHAT_MEMORY_ROLLING_SUMMARY_UPDATE_EVERY_N_TURNS=3
CHAT_MEMORY_GAP_BRIDGE_MAX_MESSAGES=15
CHAT_MEMORY_GAP_BRIDGE_MAX_CHARS=15000
CHAT_MEMORY_WORKER_CONCURRENCY=1
CHAT_MEMORY_BACKFILL_BATCH_MESSAGES=40
CHAT_MEMORY_BACKFILL_COOLDOWN_MS=500
CHAT_MEMORY_WRITE_RETRY_MAX=2
CHAT_MEMORY_SYNC_REBUILD_TIMEOUT_MS=600000 # Per-batch LLM timeout for rolling summary backfill/rebuild.
CHAT_MEMORY_SYNC_REBUILD_TOTAL_TIMEOUT_MS=0 # Optional total timeout for sync rebuild (0 disables).

# Chat Gist——assistant 要点缓存
CHAT_GIST_ENABLED=true
CHAT_GIST_MAX_CHARS=220
CHAT_GIST_WORKER_PROVIDER=deepseek
CHAT_GIST_WORKER_MODEL=deepseek-chat
CHAT_GIST_WORKER_CONCURRENCY=2
CHAT_GIST_WORKER_TIMEOUT_MS=30000
CHAT_GIST_WORKER_TEMPERATURE=0.4
CHAT_GIST_WORKER_TOP_P=0.9
CHAT_GIST_WORKER_MAX_OUTPUT_TOKENS=512
CHAT_GIST_WORKER_STREAM=false
CHAT_GIST_WORKER_ENABLE_WEB_SEARCH=false
CHAT_GIST_WORKER_THINKING_LEVEL=MINIMAL
CHAT_GIST_WORKER_THINKING_BUDGET=0
CHAT_GIST_WORKER_SAFETY_HARASSMENT=OFF
CHAT_GIST_WORKER_SAFETY_HATE_SPEECH=OFF
CHAT_GIST_WORKER_SAFETY_SEXUALLY_EXPLICIT=OFF
CHAT_GIST_WORKER_SAFETY_DANGEROUS_CONTENT=OFF
CHAT_GIST_WORKER_OPENAI_COMPATIBLE_BODY_JSON={}
CHAT_GIST_WORKER_GOOGLE_GENAI_CONFIG_JSON={}

# Chat: 回收站清理（必填；设为 0 可禁用清理）
CHAT_TRASH_RETENTION_DAYS=30
CHAT_TRASH_CLEAN_INTERVAL_MS=21600000
CHAT_TRASH_PURGE_BATCH_SIZE=500

# Chat: 默认生成参数（必填）
CHAT_DEFAULT_TEMPERATURE=0.7
CHAT_DEFAULT_TOP_P=0.9
CHAT_DEFAULT_MAX_OUTPUT_TOKENS=2048
CHAT_DEFAULT_PRESENCE_PENALTY=0
CHAT_DEFAULT_FREQUENCY_PENALTY=0
CHAT_DEFAULT_STREAM=true
CHAT_DEFAULT_ENABLE_WEB_SEARCH=false
CHAT_DEFAULT_SYSTEM_PROMPT_PRESET_ID=default

# Chat: 默认提供方与模型（必填）
CHAT_DEFAULT_PROVIDER=deepseek
GROK_DEFAULT_MODEL=grok-4
DEEPSEEK_DEFAULT_MODEL=deepseek-chat
GEMINI_DEFAULT_MODEL=gemini-3-flash-preview
OPENROUTER_DEFAULT_MODEL=openai/gpt-4o-mini

# LLM: 通用超时（必填）
LLM_TIMEOUT_MS=60000

# Logging (可选)
LOG_LEVEL=info
LOG_TO_CONSOLE=true
LOG_TO_FILE=true
LOG_DIR=logs

LOG_ERROR_FILE=error.log
LOG_WARN_FILE=warn.log
LOG_INFO_FILE=info.log
LOG_DEBUG_FILE=debug.log
LOG_CHAT_FILE=chat.log

LOG_DEBUG_FULL_FILE=debug-full.log
LOG_DEBUG_ROLLING_FILE=debug-rolling.log
LOG_DEBUG_GIST_FILE=debug-gist.log
LOG_DEBUG_FULL_ENABLED=false
LOG_DEBUG_ROLLING_ENABLED=false
LOG_DEBUG_GIST_ENABLED=false

# Article: 临时图片清理（必填）
ARTICLE_TEMP_IMAGE_TTL_MS=86400000
ARTICLE_CLEAN_INTERVAL_MS=21600000

# （可选）提供商默认参数覆盖（不填则继承 CHAT_DEFAULT_*）
# Grok（不支持 presence/frequency penalty、web search）
GROK_DEFAULT_TEMPERATURE=
GROK_DEFAULT_TOP_P=
GROK_DEFAULT_MAX_OUTPUT_TOKENS=
GROK_DEFAULT_STREAM=
GROK_DEFAULT_ENABLE_WEB_SEARCH=false

# DeepSeek（不支持 web search）
DEEPSEEK_DEFAULT_TEMPERATURE=0.9
DEEPSEEK_DEFAULT_TOP_P=1
DEEPSEEK_DEFAULT_MAX_OUTPUT_TOKENS=2048
DEEPSEEK_DEFAULT_PRESENCE_PENALTY=0.2
DEEPSEEK_DEFAULT_FREQUENCY_PENALTY=0.2
DEEPSEEK_DEFAULT_STREAM=true
DEEPSEEK_DEFAULT_ENABLE_WEB_SEARCH=false

# Gemini
GEMINI_DEFAULT_TEMPERATURE=1
GEMINI_DEFAULT_TOP_P=0.95
GEMINI_DEFAULT_MAX_OUTPUT_TOKENS=2048
GEMINI_DEFAULT_STREAM=true
GEMINI_DEFAULT_ENABLE_WEB_SEARCH=true

# OPENROUTER
OPENROUTER_DEFAULT_TEMPERATURE=0.7
OPENROUTER_DEFAULT_TOP_P=0.95
OPENROUTER_DEFAULT_MAX_OUTPUT_TOKENS=1234
OPENROUTER_DEFAULT_STREAM=true
OPENROUTER_DEFAULT_ENABLE_WEB_SEARCH=true
